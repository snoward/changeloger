spec:
  inputs:
    stage:
      default: deploy
    telegram_token:
      default: $TELEGRAM_TOKEN
    telegram_chat_id:
      default: $TELEGRAM_CHAT_ID
---
send-notification:
  stage: $[[ inputs.stage ]]
  image: docker-proxy.kontur.host/alpine/curl:latest
  script:
    - |
      RELEASE_NOTES=$(cat release_notes.txt)
      TEXT="Завершен деплой ${CI_PROJECT_TITLE}%0ADeploy status: ✅%0AЗапустил: ${GITLAB_USER_NAME}%0A%0AСписок задач:"
      curl -s --max-time 10 \
        -d "chat_id=$[[ inputs.telegram_chat_id ]]&disable_web_page_preview=1&text=${TEXT}%0A${RELEASE_NOTES}" \
        "https://api.telegram.org/bot$[[ inputs.telegram_token ]]/sendMessage" > /dev/null
